C51 COMPILER V9.00   BULINGBULING                                                          12/21/2018 20:44:35 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE BULINGBULING
OBJECT MODULE PLACED IN bulingbuling.OBJ
COMPILER INVOKED BY: C:\0000000\keil4\C51\BIN\C51.EXE bulingbuling.c COMPACT BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include <bulingbuling.h>
   2          
   3          unsigned char timer0h, timer0l, time;
   4          //--------------------------------------
   5          //单片机晶振采用11.0592MHz
   6          // 频率-半周期数据表 高八位 本软件共保存了四个八度的28个频率数据
   7          code unsigned char FREQH[] = {
   8                  0xF2, 0xF3, 0xF5, 0xF5, 0xF6, 0xF7, 0xF8, //低音1234567
   9                  0xF9, 0xF9, 0xFA, 0xFA, 0xFB, 0xFB, 0xFC, 0xFC,//1,2,3,4,5,6,7,i
  10                  0xFC, 0xFD, 0xFD, 0xFD, 0xFD, 0xFE, //高音 234567
  11                  0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFE, 0xFF}; //超高音 1234567
  12                  // 频率-半周期数据表 低八位
  13                  code unsigned char FREQL[] = {
  14                          0x42, 0xC1, 0x17, 0xB6, 0xD0, 0xD1, 0xB6, //低音1234567
  15                          0x21, 0xE1, 0x8C, 0xD8, 0x68, 0xE9, 0x5B, 0x8F, //1,2,3,4,5,6,7,i
  16                          0xEE, 0x44, 0x6B, 0xB4, 0xF4, 0x2D, //高音 234567
  17                          0x47, 0x77, 0xA2, 0xB6, 0xDA, 0xFA, 0x16}; //超高音 1234567
  18                          //--------------------------------------
  19                          code unsigned char sszymmh[] = {
  20                                  2,3,2,3,3,5,2,3,2,3,3,5,2,1,1,1,6,1,1,0};
  21                                  /*              code unsigned char sszymmh[] = {1,2,3,2,2,1,6,1,1,1,2,1,5,1,2,5,2,3,1,3,1,6,2,1,5,2,1,3,2,1,5
  22                                  ,2,1,2,2,4,2,2,3,3,2,1,7,1,2,6,1,2,5,1,3,6,1,1,1,2,2,2,2,2,3,1,2,1,2,2,6,1,1,5,1,1,6,1,1,1,2,1,5,
  23                                  1,4,3,2,3,5,2,1,7,1,2,2,2,2,6,1,1,1,2,1,5,1,4,3,1,1,5,1,2,3,1,2,5,1,1,6,1,1,7,1,1,2,2,1,6,1,
  24                                  4,5,1,1,6,1,1,1,2,3,2,2,1,5,2,2,3,2,2,2,2,2,3,2,1,2,2,1,1,2,2,6,1,1,5,1,1,3,1,2,3,1,4,1,2,4,6,
  25                                  1,3,1,2,1,6,1,1,5,1,1,3,1,1,5,1,1,6,1,1,1,2,1,5,1,4,0, 0, 0};      //   梁祝    */
  26                                  /*      code unsigned char sszymmh[] = {5,1,1, 1,2,3, 1,2,1, 1,2,1, 1,2,1, 5,1,1, 6,1,1, 7,1,1, 1,2,2, 1,2,2
             -,
  27                                  3,2,1, 1,2,1, 2,2,1, 3,2,1, 5,2,2, 5,2,1, 5,2,2,
  28                                  3,2,2, 3,2,1, 1,2,2, 3,2,1, 5,2,2, 3,2,1, 2,2,2, 2,2,4,
  29                                  6,2,2,5,2,2,2,2,2,3,2,2,5,2,1,3,2,2,5,2,1,3,2,1,2,2,1,3,2,1,1,2,1,2,2,1,3,2,2,
  30                                  5,2,2,6,1,1,1,2,1,1,2,1,3,2,2,3,2,1,5,2,2,5,2,1,2,2,1,2,2,1,2,2,1,6,1,1,6,1,1,2,2,4,
  31                                  5,1,1,1,2,3,1,2,1,3,2,3,3,2,1,5,2,4,5,2,4,
  32                                  1,2,2,3,2,1,5,2,1,5,1,1,6,2,2,5,2,2,
  33                                  3,2,2,1,2,1,5,2,1,5,2,1,5,2,1,3,2,1,1,2,1,5,1,2,1,2,2,
  34                                  3,1,1,1,1,1,5,2,1,5,2,1,5,2,1,3,2,1,1,2,1,5,1,2,1,2,2,5,1,2,1,2,2,5,1,2,1,2,2,1,2,2,
  35                                  0, 0, 0* };//国歌 */
  36                                  /*              code unsigned char sszymmh[] = {6,2,3,5,2,1,3,2,2,5,2,2,6,2,1,6,2,2,5,2,1,3,2,4,6,1,3,1,2,1,2,2,2,5
             -,2,1,3,2,1,2,2,4,
  37                                  6,2,3,2,3,1,2,3,2,1,3,1,7,2,1,6,2,3,5,2,1,3,2,4,2,2,1,5,2,1,5,2,1,3,2,1,2,2,1,3,2,1,1,2,1,7,1,1,6,1,4,
  38                                  1,2,3,6,1,1,6,2,1,1,2,2,2,2,2,5,
  39                                  2,1,3,2,1,2,2,4,5,2,3,3,2,1,3,2,
  40                                  2,5,2,2,6,2,4,2,3,3,2,3,1,1,3,2,
  41                                  2,3,2,6,2,1,1,3,1,5,2,1,6,2,1,3,
  42                                  2,4,2,2,1,5,2,1,5,2,1,3,2,1,2,2,
  43                                  1,3,2,1,1,2,1,7,1,1,6,1,4,
  44                                  0, 0, 0};//虞美人 */
  45                                  //结束标记
  46                                  //世上只有妈妈好数据表 要想演奏不同的乐曲, 只需要修改这个数据表
  47                                  //code unsigned char sszymmh[] = {
  48                                  //6, 2, 3, 5, 2, 1, 3, 2, 2, 5, 2, 2, 1, 3, 2, 6, 2, 1, 5, 2, 1, 
  49                                  //一个音符有三个数字。前为第几个音、中为第几个八度、后为时长（以半拍为单位）。
  50                                  //6, 2, 3代表：6, 中音, 3个半拍;
  51                                  //5, 2, 1代表：5, 中音, 1个半拍;
  52                                  //3, 2, 2代表：3, 中音, 2个半拍;
  53                                  //5, 2, 2代表：5, 中音, 2个半拍;
C51 COMPILER V9.00   BULINGBULING                                                          12/21/2018 20:44:35 PAGE 2   

  54                                  //1, 3, 2代表：1, 高音, 2个半拍;
  55                                  //
  56                                  //6, 2, 4, 3, 2, 2, 5, 2, 1, 6, 2, 1, 5, 2, 2, 3, 2, 2, 1, 2, 1,
  57                                  //6, 1, 1, 5, 2, 1, 3, 2, 1, 2, 2, 4, 2, 2, 3, 3, 2, 1, 5, 2, 2,
  58                                  //5, 2, 1, 6, 2, 1, 3, 2, 2, 2, 2, 2, 1, 2, 4, 5, 2, 3, 3, 2, 1,
  59                                  //2, 2, 1, 1, 2, 1, 6, 1, 1, 1, 2, 1, 5, 1, 6, 0, 0, 0,,,,,,,,,,,,,,,,,,,,,6,2,3, 6,2,1, 1,3,2, 7,2,1, 
             -6,2,1, 5,2,2, 3,2,1, 5,2,1, 6,2,4, 3,2,3,};
  60                                  //--------------------------------------
  61                                  void t0int() interrupt 1 //T0中断程序，控制发音的音调
  62                                  {
  63   1                                      TR0 = 0; //先关闭T0
  64   1                                      speaker = !speaker; //输出方波, 发音
  65   1                                      TH0 = timer0h; //下次的中断时间, 这个时间, 控制音调高低
  66   1                                      TL0 = timer0l;
  67   1                                      TR0 = 1; //启动T0
  68   1                              }
  69                                  //--------------------------------------
  70                                  void delay(unsigned char t) //延时程序，控制发音的时间长度
  71                                  {
  72   1                                      unsigned char t1;
  73   1                                      unsigned long t2;
  74   1                                      for(t1 = 0; t1 < t; t1++) //双重循环, 共延时t个半拍
  75   1                                              for(t2 = 0; t2 < 8000; t2++); //延时期间, 可进入T0中断去发音
  76   1                                      TR0 = 0; //关闭T0, 停止发音
  77   1                              }
  78                                  //--------------------------------------
  79                                  void song() //演奏一个音符
  80                                  {
  81   1                                      TH0 = timer0h; //控制音调
  82   1                                      TL0 = timer0l;
  83   1                                      TR0 = 1; //启动T0, 由T0输出方波去发音
  84   1                                      delay(time); //控制时间长度
  85   1                              }
  86          
  87                                  void timr0init()
  88                                  {
  89   1                                      TMOD = 1; //置T0定时工作方式1
  90   1                                      ET0 = 1; //开T0中断
  91   1                                      EA = 1; //开CPU中断
  92   1                              }
  93          
  94                                  //--------------------------------------
  95                                  void wengwengweng()
  96                                  {
  97   1                                      unsigned char k, i;
  98   1                                      
  99   1                                      while(1) 
 100   1                                      {
 101   2                                              i = 0;
 102   2                                              time = 1; 
 103   2                                              while(time) 
 104   2                                              {
 105   3                                                      k = sszymmh[i] + 7 * sszymmh[i + 1] - 1;
 106   3                                                      //第i个是音符, 第i+1个是第几个八度
 107   3                                                      timer0h = FREQH[k]; //从数据表中读出频率数值
 108   3                                                      timer0l = FREQL[k]; //实际上, 是定时的时间长度
 109   3                                                      time = sszymmh[i + 2]; //读出时间长度数值
 110   3                                                      i += 3;
 111   3                                                      song(); //发出一个音符
 112   3                                              }
 113   2                                      }
 114   1                              }
C51 COMPILER V9.00   BULINGBULING                                                          12/21/2018 20:44:35 PAGE 3   

 115                                  /*======================================
 116                                  应网友要求，下面再详细写一下乐谱和数据的转换关系。
 117                                  以李叔同大师的《送别》的前二小节来说明转换的方法。
 118                                  这部分的歌词是："长 亭 外， 古 道 边，"；
 119                                  这部分的乐谱是：| 5 35 1 － | 6 16 5 － |。
 120                                  （注意：乐谱中的1是高音，上边是带点的；还有些音符，应该有下划线，在这里都无法标出。感兴趣的网友应该去查
             -看正规的乐谱。）
 121                                  那么，据此就可以写出《送别》前二小节的数据表：
 122                                  //--------------------------------------*/
 123                                  //code unsigned char sszymmh[] = {
 124                                  //5, 2, 2, 3, 2, 1, 5, 2, 1, 1, 3, 4, 
 125                                  //嗦,中音,2个半拍;　咪,中音,1个半拍;　嗦,中音,1个半拍;　哆,高音,4个半拍
 126                                  //6, 2, 2, 1, 3, 1, 6, 2, 1, 5, 2, 4,
 127                                  //啦,中音,2个半拍;　哆,高音,1个半拍;　啦,中音,1个半拍;　嗦,中音,4个半拍
 128                                  //0, 0, 0};
 129                                  //结束标记
 130                                  /*--------------------------------------
 131                                  记住：三个数字一组，代表一个音符。
 132                                  第一个数字是1234567之一，代表音符哆来咪发...；
 133                                  第二个数字是0123之一，代表低音、中音、高音、超高音；
 134                                  第三个数字是半拍的个数，代表时间长度。
 135                                  当三个数字都是0，就代表乐曲数据表的结尾。
 136                                  用这个数据表，替换掉程序中《世上只有妈妈好》的数据表，本程序就可以播放《送别》的前两小节。
 137                                  */ 


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    222    ----
   CONSTANT SIZE    =     76    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =      3       8
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
